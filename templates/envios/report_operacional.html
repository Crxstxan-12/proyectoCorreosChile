{% extends 'base.html' %}
{% block title %}Reporte Operacional{% endblock %}
{% block content %}
<div class="card mb-3">
  <div class="card-header d-flex justify-content-between align-items-center">
    <div>Reporte Operacional</div>
    <div>
      <a class="btn btn-outline-secondary btn-sm" href="?desde={{ desde }}&hasta={{ hasta }}&estado={{ estado }}&transportista_id={{ transportista_id }}&export=csv">CSV</a>
      <a class="btn btn-outline-secondary btn-sm" href="?desde={{ desde }}&hasta={{ hasta }}&estado={{ estado }}&transportista_id={{ transportista_id }}&export=xls">XLS</a>
    </div>
  </div>
  <div class="card-body">
    <form class="row mb-3" method="get">
      <div class="col-md-3"><label>Desde</label><input type="date" class="form-control" name="desde" value="{{ desde }}"></div>
      <div class="col-md-3"><label>Hasta</label><input type="date" class="form-control" name="hasta" value="{{ hasta }}"></div>
      <div class="col-md-3"><label>Estado</label>
        <select class="form-control" name="estado">
          <option value="" {% if not estado %}selected{% endif %}>Todos</option>
          <option value="pendiente" {% if estado == 'pendiente' %}selected{% endif %}>Pendiente</option>
          <option value="en_transito" {% if estado == 'en_transito' %}selected{% endif %}>En tránsito</option>
          <option value="entregado" {% if estado == 'entregado' %}selected{% endif %}>Entregado</option>
          <option value="cancelado" {% if estado == 'cancelado' %}selected{% endif %}>Cancelado</option>
        </select>
      </div>
      <div class="col-md-3"><label>Transportista</label>
        <select class="form-control" name="transportista_id">
          <option value="" {% if not transportista_id %}selected{% endif %}>Todos</option>
          {% for t in transportistas %}
          <option value="{{ t.id }}" {% if transportista_id == t.id|stringformat:"s" %}selected{% endif %}>{{ t.nombre }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-12 mt-2 d-flex justify-content-end"><button class="btn btn-primary">Generar</button></div>
    </form>
    <h6 class="mb-2">Por sucursal (origen)</h6>
    <div class="table-responsive mb-3"><table class="table table-striped"><thead><tr><th>Origen</th><th>Total</th><th>Entregados</th><th>En tránsito</th><th>Pendientes</th><th>Cancelados</th></tr></thead><tbody>
      {% for r in por_origen %}
      <tr><td>{{ r.origen|default:"-" }}</td><td>{{ r.total }}</td><td>{{ r.entregados }}</td><td>{{ r.transito }}</td><td>{{ r.pendientes }}</td><td>{{ r.cancelados }}</td></tr>
      {% empty %}<tr><td colspan="6" class="text-center text-muted">Sin datos</td></tr>{% endfor %}
    </tbody></table></div>
    <h6 class="mb-2">Por transportista</h6>
    <div class="table-responsive"><table class="table table-striped"><thead><tr><th>Transportista</th><th>Total</th><th>Entregados</th><th>En tránsito</th><th>Pendientes</th><th>Cancelados</th></tr></thead><tbody>
      {% for r in por_transportista %}
      <tr><td>{{ r.transportista__nombre|default:"-" }}</td><td>{{ r.total }}</td><td>{{ r.entregados }}</td><td>{{ r.transito }}</td><td>{{ r.pendientes }}</td><td>{{ r.cancelados }}</td></tr>
      {% empty %}<tr><td colspan="6" class="text-center text-muted">Sin datos</td></tr>{% endfor %}
    </tbody></table></div>
    <div class="mt-3"><small class="text-muted">Reclamos asociados en el rango: {{ recuentos.reclamos }}</small></div>
  </div>
  <div class="card-footer text-muted">Generado: {{ fecha }}</div>
  </div>
</div>
{% endblock %}
